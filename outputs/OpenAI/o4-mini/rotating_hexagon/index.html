<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotating Hexagon with Bouncing Balls</title>
    <style>
        * { margin: 0; padding: 0; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #111; }
        canvas { display: block; }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
(function() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let width, height, cx, cy;

    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        cx = width / 2;
        cy = height / 2;
        R = Math.min(width, height) * 0.4;
        hexInscribedR = R * Math.cos(Math.PI / 6);
    }
    window.addEventListener('resize', resize);
    resize();

    // Hexagon settings
    let rotation = 0;
    const rotationSpeed = Math.PI / 6; // 30Â° per second

    // Balls settings
    const balls = [];
    const ballCount = 15;
    for (let i = 0; i < ballCount; i++) {
        const r = 5 + Math.random() * 15;
        // place inside inscribed circle
        const angle = Math.random() * 2 * Math.PI;
        const rr = (hexInscribedR - r) * Math.sqrt(Math.random());
        const x = cx + rr * Math.cos(angle);
        const y = cy + rr * Math.sin(angle);
        const speed = 50 + Math.random() * 100;
        const vAngle = Math.random() * 2 * Math.PI;
        balls.push({ x, y, r, vx: speed * Math.cos(vAngle), vy: speed * Math.sin(vAngle), color: `hsl(${Math.random()*360},80%,60%)` });
    }

    let lastTime = 0;

    function drawHexagon(angle) {
        ctx.beginPath();
        for (let i = 0; i < 6; i++) {
            const a = angle + i * Math.PI / 3;
            const x = cx + R * Math.cos(a);
            const y = cy + R * Math.sin(a);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;
        ctx.stroke();

        // Return edges (p1->p2) and normals
        const edges = [];
        const pts = [];
        for (let i = 0; i < 6; i++) {
            const a = angle + i * Math.PI / 3;
            pts.push({ x: cx + R * Math.cos(a), y: cy + R * Math.sin(a) });
        }
        for (let i = 0; i < 6; i++) {
            const p1 = pts[i];
            const p2 = pts[(i + 1) % 6];
            // outward normal
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            const len = Math.hypot(dx, dy);
            const nx = dy / len;
            const ny = -dx / len;
            edges.push({ p1, p2, nx, ny });
        }
        return edges;
    }

    function update(dt) {
        // update balls
        for (const b of balls) {
            b.x += b.vx * dt;
            b.y += b.vy * dt;
        }
    }

    function collideWithHex(edges) {
        for (const b of balls) {
            for (const e of edges) {
                // distance from ball center to line
                const px = b.x - e.p1.x;
                const py = b.y - e.p1.y;
                const dist = px * e.nx + py * e.ny;
                if (dist > -b.r) {
                    // reflect velocity
                    const vDotN = b.vx * e.nx + b.vy * e.ny;
                    b.vx -= 2 * vDotN * e.nx;
                    b.vy -= 2 * vDotN * e.ny;
                    // push out of wall
                    const overlap = b.r + dist;
                    b.x += -overlap * e.nx;
                    b.y += -overlap * e.ny;
                }
            }
        }
    }

    function drawBalls() {
        for (const b of balls) {
            ctx.beginPath();
            ctx.arc(b.x, b.y, b.r, 0, 2 * Math.PI);
            ctx.fillStyle = b.color;
            ctx.fill();
        }
    }

    function animate(time) {
        const dt = (time - lastTime) / 1000;
        lastTime = time;
        rotation += rotationSpeed * dt;
        ctx.clearRect(0, 0, width, height);
        const edges = drawHexagon(rotation);
        update(dt);
        collideWithHex(edges);
        drawBalls();
        requestAnimationFrame(animate);
    }
    requestAnimationFrame(function(ts) { lastTime = ts; requestAnimationFrame(animate); });
})();
</script>
</body>
</html>